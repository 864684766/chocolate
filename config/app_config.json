{
  "app": {
    "name": "chocolate",
    "version": "1.0.0",
    "description": "智能AI助手系统"
  },

  "server": {
    "host": "0.0.0.0",
    "port": 8000,
    "reload": true,
    "description": "API服务器配置"
  },

  "llm": {
    "default_provider": "qwen",
    "default_model": "Qwen/Qwen3-0.6B",
    "default_temperature": 0.7,
    "request_timeout": 30,
    "description": "大语言模型基础配置"
  },

  "cache": {
    "max_cache_size": 10,
    "description": "模型实例缓存配置"
  },

  "agent": {
    "verbose": false,
    "max_iterations": 5,
    "max_execution_time": 300,
    "handle_parsing_errors": true,
    "return_intermediate_steps": false,
    "description": "Agent执行器配置"
  },

  "ingestion": {
    "supported_extensions": [
      ".txt",
      ".md",
      ".pdf",
      ".docx",
      ".png",
      ".jpg",
      ".jpeg",
      ".webp",
      ".mp3",
      ".wav",
      ".mp4",
      ".mov",
      ".avi",
      ".mkv"
    ]
  },

  "vectorization": {
    "model": "D:/models/sentence-transformers/paraphrase-multilingual-MiniLM-L12-v2",
    "device": "auto",
    "batch_size": 32,
    "database": {
      "host": "124.71.135.104",
      "port": 8000,
      "collection_name": "documents"
    }
  },

  "retrieval": {
    "preview": {
      "max_items": 3
    },
    "scoring": {
      "metric": "cosine_distance",
      "normalize": true,
      "params": { "alpha": 1.0 }
    },
    "rerank": {
      "model": "D:/models/BAAI/bge-reranker-base",
      "top_n": 10,
      "timeout_ms": 800,
      "batch_size": 16
    },
    "meilisearch": {
      "enabled": false,
      "host": "http://localhost:7700",
      "api_key": "",
      "index": "documents"
    }
  },

  "providers": {
    "qwen": {
      "api_key": "",
      "description": "Qwen 本地/Transformers 提供商",
      "models": {
        "Qwen/Qwen3-0.6B": {
          "description": "Qwen3 0.6B (Transformers)",
          "backend": "transformers",
          "model": "D:/models/Qwen/Qwen3-0.6B",
          "max_new_tokens": 256,
          "temperature": 0.7,
          "device_map": "cpu",
          "torch_dtype": "float16",
          "enable_thinking": false,
          "aliases": ["qwen3-0.6b", "qwen3-mini"]
        }
      }
    },
    "openai": {
      "api_key": "your_openai_api_key_here",
      "description": "OpenAI 提供商",
      "models": {
        "gpt-4": {
          "description": "OpenAI GPT-4 模型",
          "backend": "native",
          "model": "gpt-4",
          "max_new_tokens": 1024,
          "temperature": 0.7,
          "aliases": ["gpt4"]
        },
        "gpt-4-turbo": {
          "description": "OpenAI GPT-4 Turbo 模型",
          "backend": "native",
          "model": "gpt-4-turbo",
          "max_new_tokens": 1024,
          "temperature": 0.7
        },
        "gpt-3.5-turbo": {
          "description": "OpenAI GPT-3.5 Turbo 模型",
          "backend": "native",
          "model": "gpt-3.5-turbo",
          "max_new_tokens": 1024,
          "temperature": 0.7,
          "aliases": ["gpt35"]
        }
      }
    },
    "google": {
      "api_key": "AIzaSyBpGJx5F4MUccXrr5BC8TJvdLr36qw8A-M",
      "description": "Google 提供商",
      "models": {
        "gemini-2.5-flash": {
          "description": "Google Gemini 2.5 Flash 模型",
          "backend": "native",
          "model": "gemini-2.5-flash",
          "max_new_tokens": 2048,
          "temperature": 0.7,
          "aliases": ["gemini"]
        },
        "gemini-2.5-pro": {
          "description": "Google Gemini 2.5 Pro 模型",
          "backend": "native",
          "model": "gemini-2.5-pro",
          "max_new_tokens": 2048,
          "temperature": 0.7,
          "generation_config": {
            "response_mime_type": "text/plain",
            "max_output_tokens": 2048
          },
          "safety": {
            "hate_speech": "BLOCK_NONE",
            "harassment": "BLOCK_NONE",
            "sex": "BLOCK_NONE",
            "danger": "BLOCK_NONE"
          }
        },

        "gemini-1.5-flash": {
          "description": "Google Gemini 1.5 Flash 模型",
          "backend": "native",
          "model": "gemini-1.5-flash",
          "max_new_tokens": 2048,
          "temperature": 0.7
        },
        "gemini-1.5-pro": {
          "description": "Google Gemini 1.5 Pro 模型",
          "backend": "native",
          "model": "gemini-1.5-pro",
          "max_new_tokens": 2048,
          "temperature": 0.7,
          "generation_config": {
            "response_mime_type": "text/plain",
            "max_output_tokens": 2048
          },
          "safety": {
            "hate_speech": "BLOCK_NONE",
            "harassment": "BLOCK_NONE",
            "sex": "BLOCK_NONE",
            "danger": "BLOCK_NONE"
          }
        },

        "gemini-2.5-flash-image-preview": {
          "description": "Google Gemini 2.5-flash-image-preview 模型",
          "backend": "native",
          "model": "gemini-2.5-flash-image-preview",
          "max_new_tokens": 2048,
          "temperature": 0.7,
          "generation_config": {
            "response_mime_type": "text/plain",
            "max_output_tokens": 2048
          },
          "safety": {
            "hate_speech": "BLOCK_NONE",
            "harassment": "BLOCK_NONE",
            "sex": "BLOCK_NONE",
            "danger": "BLOCK_NONE"
          }
        }
      }
    },
    "anthropic": {
      "api_key": "your_anthropic_api_key_here",
      "description": "Anthropic 提供商",
      "models": {
        "claude-3-sonnet-20240229": {
          "description": "Anthropic Claude 3 Sonnet 模型",
          "backend": "native",
          "model": "claude-3-sonnet-20240229",
          "max_new_tokens": 1024,
          "temperature": 0.7,
          "aliases": ["claude"]
        },
        "claude-3-haiku-20240307": {
          "description": "Anthropic Claude 3 Haiku 模型",
          "backend": "native",
          "model": "claude-3-haiku-20240307",
          "max_new_tokens": 1024,
          "temperature": 0.7
        },
        "claude-3-opus-20240229": {
          "description": "Anthropic Claude 3 Opus 模型",
          "backend": "native",
          "model": "claude-3-opus-20240229",
          "max_new_tokens": 1024,
          "temperature": 0.7
        }
      }
    }
  },

  "environment": {
    "description": "环境配置"
  },

  "tools": {
    "available_tools": ["search_docs", "http_get", "calc"],
    "description": "可用工具列表"
  },

  "media_processing": {
    "chunking": {
      "auto": true,
      "defaults": { "chunk_size": 800, "overlap": 150 },
      "by_media_type": {
        "text": { "chunk_size": 800, "overlap": 120 },
        "pdf": { "chunk_size": 900, "overlap": 180 },
        "image": { "chunk_size": 300, "overlap": 80 },
        "video": { "chunk_size": 1000, "overlap": 200 },
        "audio": { "chunk_size": 1000, "overlap": 200 },
        "code": { "chunk_size": 400, "overlap": 160 }
      },
      "targets": {
        "target_tokens_per_chunk": 512,
        "overlap_ratio": 0.15,
        "max_context_tokens": 8192
      }
    },
    "image_captioning": {
      "enabled": true,
      "model": "D:/models/Salesforce/blip-image-captioning-base",
      "generation": {
        "num_captions": 3,
        "max_length": 50,
        "temperature": 0.7,
        "do_sample": true
      },
      "filters": {
        "min_length": 5,
        "max_length": 120,
        "max_gibberish_ratio": 0.3,
        "blacklist_keywords": ["优惠", "扫码", "购买", "VX"]
      },
      "rerank": {
        "enabled": true,
        "model": "D:/models/openai/clip-vit-base-patch32",
        "top_k": 2,
        "min_clip_prob": 0.2
      },
      "translation": {
        "enabled": true,
        "model": "D:/models/Helsinki-NLP/opus-mt-en-zh",
        "batch_size": 16
      },
      "deduplication": {
        "approximate_enabled": true,
        "similarity_threshold": 0.95,
        "embed_model": "sentence-transformers/paraphrase-multilingual-MiniLM-L12-v2",
        "forbid_repeat_ngram": 3
      }
    },
    "ocr": {
      "engines": ["easyocr", "paddleocr", "tesseract"],
      "languages": ["ch_sim", "en"],
      "confidence_threshold": 0.5
    },
    "video_processing": {
      "speech_recognition": {
        "model": "whisper-base",
        "language": "zh-CN"
      }
    }
  },

  "prompts": {
    "react_template": "你是一个智能助理，能够使用工具来帮助回答问题。你有以下工具可用：\n\n{tools}\n可以使用的工具名称有：{tool_names}\n\n这是你和用户之前的对话历史：{chat_history}\n\n使用以下格式：\n\nQuestion: 用户的问题\nThought: 我需要思考如何回答这个问题\nAction: 要使用的工具名称\nAction Input: 工具的输入参数\nObservation: 工具返回的结果\n... (这个 Thought/Action/Action Input/Observation 可以重复多次)\nThought: 现在我知道最终答案了\nFinal Answer: 给用户的最终回答\n\n重要提示：\n1. 用中文思考和回答\n2. 如果需要计算，使用 calc 工具\n3. 如果需要搜索信息，使用 search_docs 工具\n4. 如果需要获取网页内容，使用 http_get 工具\n5. 可以组合使用多个工具来解决复杂问题\n6. 最终答案要简洁明了，用自然语言回答\n\nQuestion: {input}\nThought: {agent_scratchpad}",
    "retrieval": {
      "system": "你是一个中文助理，请基于提供的上下文回答。若信息不足，请明确说明。",
      "user_template": "问题：{query}\n\n上下文：\n{context}"
    },
    "description": "提示词模板配置"
  },
  "logging": {
    "level": "INFO",
    "format": "%(asctime)s - %(name)s - %(levelname)s - %(message)s",
    "handlers": {
      "console": {
        "enabled": true,
        "level": "INFO"
      },
      "file": {
        "enabled": true,
        "level": "DEBUG",
        "filename": "logs/chocolate.log",
        "use_daily_rotation": true,
        "rotation_when": "midnight",
        "rotation_interval": 1,
        "backup_count": 30,
        "encoding": "utf-8"
      }
    }
  },
  "observability": {
    "langsmith": {
      "enabled": true,
      "api_key": "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",
      "project": "chocolate-dev",
      "endpoint": "https://api.smith.langchain.com"
    }
  },

  "language_processing": {
    "chinese": {
      "chunking": {
        "default_chunk_size": 800,
        "default_overlap": 150,
        "use_langchain": true,
        "separators": ["\n\n", "\n", "。", "！", "？", "；", "，", " ", ""]
      },
      "text_cleaning": {
        "normalize_whitespace_pattern": "[ \\t]+",
        "normalize_whitespace_replacement": " ",
        "normalize_newlines_pattern": "\\n\\s*\\n\\s*\\n+",
        "normalize_newlines_replacement": "\n\n"
      },
      "sentence_splitting": {
        "sentence_endings_pattern": "[。！？；]"
      }
    }
  },

  "metadata": {
    "default_language": "zh",
    "language_detection": {
      "chinese_threshold": 0.3,
      "min_text_length": 10,
      "fallback_language": "zh",
      "aliases": {
        "中文,简体中文,zh,zh_cn": "zh",
        "英文,english,en": "en"
      }
    },
    "metadata_whitelist": [
      { "field": "doc_id", "type": "string" },
      { "field": "source", "type": "string" },
      { "field": "filename", "type": "string" },
      { "field": "content_type", "type": "string" },
      { "field": "media_type", "type": "string" },
      { "field": "lang", "type": "string" },
      { "field": "tags", "type": "array" },
      { "field": "keyphrases", "type": "array" },
      { "field": "created_at", "type": "string" },
      { "field": "quality_score", "type": "number" }
    ],
    "media_type_mapping": {
      "by_extension": {
        "pdf": "pdf",
        "doc": "document",
        "docx": "document",
        "txt": "text",
        "md": "text",
        "png": "image",
        "jpg": "image",
        "jpeg": "image",
        "gif": "image",
        "bmp": "image",
        "webp": "image",
        "mp4": "video",
        "avi": "video",
        "mov": "video",
        "mkv": "video",
        "mp3": "audio",
        "wav": "audio",
        "flac": "audio"
      },
      "by_content_type": {
        "image/": "image",
        "video/": "video",
        "audio/": "audio",
        "application/pdf": "pdf",
        "text/": "text"
      },
      "default": "text",
      "by_keyword": {
        "文本,文档,text": "text",
        "图片,图像,image": "image",
        "视频,video": "video",
        "音频,audio": "audio",
        "pdf": "pdf"
      }
    },
    "required_fields": {
      "source": "unknown",
      "media_type": "text"
    },
    "keywords": {
      "method": "textrank",
      "topk": 10,
      "lang": "auto",
      "stopwords": { "path": "D:/test/chocolate/docs/stopWord.txt" }
    },
    "quality": {
      "min_len": 20,
      "sat_len": 200,
      "weights": { "garbled": 0.4, "valid": 0.2, "length": 0.2, "ocr": 0.2 },
      "observability": {
        "enabled": true,
        "threshold": 0.6,
        "alert_ratio": 0.2,
        "sample_rate": 0.01
      }
    }
  }
}
